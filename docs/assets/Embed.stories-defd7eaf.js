import{S as B,i as N,s as D,q as F,u as V,r as q,v as Y,b as E,t as I,o as G,p as z,j as $,z as S,m as C,a as P,k as O,l as j,n as x,d as H,w as R,D as A,B as J,F as K}from"./index-9c03537d.js";import{p as Q,w as k,M as X,T as Z,S as ee}from"./collect-stories-d3cc164c.js";import{g as te}from"./_commonjsHelpers-725317a4.js";const W=`A container for content designed to appear within an \`<iframe>\`. The component does two things:

1. Overrides padding, so that content can fill the full width of its iframe.
2. Initialises a Pym.js child for the iframe, so that it can communicate its height with its parent page.

\`\`\`html
<script>
  import { Embed } from "@onsvisual/svelte-components";
<\/script>

<Embed>
  {child_components}
</Embed>
\`\`\`
`;var L={exports:{}};/*! pym.js - v1.3.2 - 2018-02-13 */(function(g){(function(t){g.exports?g.exports=t():window.pym=t.call(this)})(function(){var t="xPYMx",n={},r=function(l){var h=document.createEvent("Event");h.initEvent("pym:"+l,!0,!0),document.dispatchEvent(h)},d=function(l){var h=new RegExp("[\\?&]"+l.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]")+"=([^&#]*)"),m=h.exec(location.search);return m===null?"":decodeURIComponent(m[1].replace(/\+/g," "))},a=function(l,h){if(!(h.xdomain!=="*"&&!l.origin.match(new RegExp(h.xdomain+"$")))&&typeof l.data=="string")return!0},u=function(l){var h=/^(?:(?:https?|mailto|ftp):|[^&:/?#]*(?:[/?#]|$))/gi;if(l.match(h))return!0},v=function(l,h,m){var c=["pym",l,h,m];return c.join(t)},b=function(l){var h=["pym",l,"(\\S+)","(.*)"];return new RegExp("^"+h.join(t)+"$")},o=Date.now||function(){return new Date().getTime()},p=function(l,h,m){var c,e,s,i=null,f=0;m||(m={});var _=function(){f=m.leading===!1?0:o(),i=null,s=l.apply(c,e),i||(c=e=null)};return function(){var w=o();!f&&m.leading===!1&&(f=w);var y=h-(w-f);return c=this,e=arguments,y<=0||y>h?(i&&(clearTimeout(i),i=null),f=w,s=l.apply(c,e),i||(c=e=null)):!i&&m.trailing!==!1&&(i=setTimeout(_,y)),s}},M=function(){for(var l=n.autoInitInstances.length,h=l-1;h>=0;h--){var m=n.autoInitInstances[h];m.el.getElementsByTagName("iframe").length&&m.el.getElementsByTagName("iframe")[0].contentWindow||n.autoInitInstances.splice(h,1)}};return n.autoInitInstances=[],n.autoInit=function(l){var h=document.querySelectorAll("[data-pym-src]:not([data-pym-auto-initialized])"),m=h.length;M();for(var c=0;c<m;++c){var e=h[c];e.setAttribute("data-pym-auto-initialized",""),e.id===""&&(e.id="pym-"+c+"-"+Math.random().toString(36).substr(2,5));var s=e.getAttribute("data-pym-src"),i={xdomain:"string",title:"string",name:"string",id:"string",sandbox:"string",allowfullscreen:"boolean",parenturlparam:"string",parenturlvalue:"string",optionalparams:"boolean",trackscroll:"boolean",scrollwait:"number"},f={};for(var _ in i)if(e.getAttribute("data-pym-"+_)!==null)switch(i[_]){case"boolean":f[_]=e.getAttribute("data-pym-"+_)!=="false";break;case"string":f[_]=e.getAttribute("data-pym-"+_);break;case"number":var w=Number(e.getAttribute("data-pym-"+_));isNaN(w)||(f[_]=w);break;default:console.err("unrecognized attribute type")}var y=new n.Parent(e.id,s,f);n.autoInitInstances.push(y)}return l||r("pym-initialized"),n.autoInitInstances},n.Parent=function(l,h,m){this.id=l,this.url=h,this.el=document.getElementById(l),this.iframe=null,this.settings={xdomain:"*",optionalparams:!0,parenturlparam:"parentUrl",parenturlvalue:window.location.href,trackscroll:!1,scrollwait:100},this.messageRegex=b(this.id),this.messageHandlers={},m=m||{},this._constructIframe=function(){var e=this.el.offsetWidth.toString();this.iframe=document.createElement("iframe");var s="",i=this.url.indexOf("#");for(i>-1&&(s=this.url.substring(i,this.url.length),this.url=this.url.substring(0,i)),this.url.indexOf("?")<0?this.url+="?":this.url+="&",this.iframe.src=this.url+"initialWidth="+e+"&childId="+this.id,this.settings.optionalparams&&(this.iframe.src+="&parentTitle="+encodeURIComponent(document.title),this.iframe.src+="&"+this.settings.parenturlparam+"="+encodeURIComponent(this.settings.parenturlvalue)),this.iframe.src+=s,this.iframe.setAttribute("width","100%"),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("marginheight","0"),this.iframe.setAttribute("frameborder","0"),this.settings.title&&this.iframe.setAttribute("title",this.settings.title),this.settings.allowfullscreen!==void 0&&this.settings.allowfullscreen!==!1&&this.iframe.setAttribute("allowfullscreen",""),this.settings.sandbox!==void 0&&typeof this.settings.sandbox=="string"&&this.iframe.setAttribute("sandbox",this.settings.sandbox),this.settings.id&&(document.getElementById(this.settings.id)||this.iframe.setAttribute("id",this.settings.id)),this.settings.name&&this.iframe.setAttribute("name",this.settings.name);this.el.firstChild;)this.el.removeChild(this.el.firstChild);this.el.appendChild(this.iframe),window.addEventListener("resize",this._onResize),this.settings.trackscroll&&window.addEventListener("scroll",this._throttleOnScroll)},this._onResize=function(){this.sendWidth(),this.settings.trackscroll&&this.sendViewportAndIFramePosition()}.bind(this),this._onScroll=function(){this.sendViewportAndIFramePosition()}.bind(this),this._fire=function(e,s){if(e in this.messageHandlers)for(var i=0;i<this.messageHandlers[e].length;i++)this.messageHandlers[e][i].call(this,s)},this.remove=function(){window.removeEventListener("message",this._processMessage),window.removeEventListener("resize",this._onResize),this.el.removeChild(this.iframe),M()},this._processMessage=function(e){if(a(e,this.settings)&&typeof e.data=="string"){var s=e.data.match(this.messageRegex);if(!s||s.length!==3)return!1;var i=s[1],f=s[2];this._fire(i,f)}}.bind(this),this._onHeightMessage=function(e){var s=parseInt(e);this.iframe.setAttribute("height",s+"px")},this._onNavigateToMessage=function(e){u(e)&&(document.location.href=e)},this._onScrollToChildPosMessage=function(e){var s=document.getElementById(this.id).getBoundingClientRect().top+window.pageYOffset,i=s+parseInt(e);window.scrollTo(0,i)},this.onMessage=function(e,s){e in this.messageHandlers||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(s)},this.sendMessage=function(e,s){this.el.getElementsByTagName("iframe").length&&(this.el.getElementsByTagName("iframe")[0].contentWindow?this.el.getElementsByTagName("iframe")[0].contentWindow.postMessage(v(this.id,e,s),"*"):this.remove())},this.sendWidth=function(){var e=this.el.offsetWidth.toString();this.sendMessage("width",e)},this.sendViewportAndIFramePosition=function(){var e=this.iframe.getBoundingClientRect(),s=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight,f=s+" "+i;f+=" "+e.top+" "+e.left,f+=" "+e.bottom+" "+e.right,this.sendMessage("viewport-iframe-position",f)};for(var c in m)this.settings[c]=m[c];return this._throttleOnScroll=p(this._onScroll.bind(this),this.settings.scrollwait),this.onMessage("height",this._onHeightMessage),this.onMessage("navigateTo",this._onNavigateToMessage),this.onMessage("scrollToChildPos",this._onScrollToChildPosMessage),this.onMessage("parentPositionInfo",this.sendViewportAndIFramePosition),window.addEventListener("message",this._processMessage,!1),this._constructIframe(),this},n.Child=function(l){this.parentWidth=null,this.id=null,this.parentTitle=null,this.parentUrl=null,this.settings={renderCallback:null,xdomain:"*",polling:0,parenturlparam:"parentUrl"},this.timerId=null,this.messageRegex=null,this.messageHandlers={},l=l||{},this.onMessage=function(e,s){e in this.messageHandlers||(this.messageHandlers[e]=[]),this.messageHandlers[e].push(s)},this._fire=function(e,s){if(e in this.messageHandlers)for(var i=0;i<this.messageHandlers[e].length;i++)this.messageHandlers[e][i].call(this,s)},this._processMessage=function(e){if(a(e,this.settings)&&typeof e.data=="string"){var s=e.data.match(this.messageRegex);if(!(!s||s.length!==3)){var i=s[1],f=s[2];this._fire(i,f)}}}.bind(this),this._onWidthMessage=function(e){var s=parseInt(e);s!==this.parentWidth&&(this.parentWidth=s,this.settings.renderCallback&&this.settings.renderCallback(s),this.sendHeight())},this.sendMessage=function(e,s){window.parent.postMessage(v(this.id,e,s),"*")},this.sendHeight=function(){var e=document.getElementsByTagName("body")[0].offsetHeight.toString();return this.sendMessage("height",e),e}.bind(this),this.getParentPositionInfo=function(){this.sendMessage("parentPositionInfo")},this.scrollParentTo=function(e){this.sendMessage("navigateTo","#"+e)},this.navigateParentTo=function(e){this.sendMessage("navigateTo",e)},this.scrollParentToChildEl=function(e){var s=document.getElementById(e).getBoundingClientRect().top+window.pageYOffset;this.scrollParentToChildPos(s)},this.scrollParentToChildPos=function(e){this.sendMessage("scrollToChildPos",e.toString())};var h=function(e){var s=document.getElementsByTagName("html")[0],i,f=s.className;try{window.self!==window.top?i="embedded":i="not-embedded"}catch{i="embedded"}f.indexOf(i)<0&&(s.className=f?f+" "+i:i,e&&e(i),r("marked-embedded"))};this.remove=function(){window.removeEventListener("message",this._processMessage),this.timerId&&clearInterval(this.timerId)};for(var m in l)this.settings[m]=l[m];this.id=d("childId")||l.id,this.messageRegex=new RegExp("^pym"+t+this.id+t+"(\\S+)"+t+"(.*)$");var c=parseInt(d("initialWidth"));return this.parentUrl=d(this.settings.parenturlparam),this.parentTitle=d("parentTitle"),this.onMessage("width",this._onWidthMessage),window.addEventListener("message",this._processMessage,!1),this.settings.renderCallback&&this.settings.renderCallback(c),this.sendHeight(),this.settings.polling&&(this.timerId=window.setInterval(this.sendHeight,this.settings.polling)),h(l.onMarkedEmbeddedStatus),this},typeof document<"u"&&n.autoInit(!0),n})})(L);var se=L.exports;const ie=te(se);function ne(g){let t;const n=g[2].default,r=F(n,g,g[1],null);return{c(){r&&r.c()},m(d,a){r&&r.m(d,a),t=!0},p(d,[a]){r&&r.p&&(!t||a&2)&&V(r,n,d,d[1],t?Y(n,d[1],a,null):q(d[1]),null)},i(d){t||(E(r,d),t=!0)},o(d){I(r,d),t=!1},d(d){r&&r.d(d)}}}function ae(g,t,n){let{$$slots:r={},$$scope:d}=t,{pymChild:a=null}=t;return G(()=>{n(0,a=new ie.Child({polling:1e3}))}),g.$$set=u=>{"pymChild"in u&&n(0,a=u.pymChild),"$$scope"in u&&n(1,d=u.$$scope)},[a,d,r]}class T extends B{constructor(t){super(),N(this,t,ae,ne,D,{pymChild:0})}}T.__docgen={version:3,name:"Embed.svelte",data:[{keywords:[{name:"type",description:"{object}"}],visibility:"public",description:"Binding for pymChild element (can be used to send messages to parent of iframe)",name:"pymChild",kind:"let",static:!1,readonly:!1,type:{kind:"type",text:"object",type:"object"},defaultValue:null}],computed:[],methods:[],components:[],description:null,keywords:[],events:[],slots:[{keywords:[],visibility:"public",description:"",name:"default"}],refs:[]};function re(g){let t,n;return{c(){t=R("div"),n=R("p"),n.textContent="Embedded content.",A(n,"margin","0"),A(t,"padding","24px 0"),A(t,"background","lightgrey")},m(r,d){P(r,t,d),J(t,n)},p:K,d(r){r&&H(t)}}}function oe(g){let t,n;const r=[g[0]];let d={$$slots:{default:[re]},$$scope:{ctx:g}};for(let a=0;a<r.length;a+=1)d=z(d,r[a]);return t=new T({props:d}),{c(){$(t.$$.fragment)},m(a,u){C(t,a,u),n=!0},p(a,u){const v=u&1?O(r,[j(a[0])]):{};u&2&&(v.$$scope={dirty:u,ctx:a}),t.$set(v)},i(a){n||(E(t.$$.fragment,a),n=!0)},o(a){I(t.$$.fragment,a),n=!1},d(a){x(t,a)}}}function le(g){let t,n,r,d,a,u;const v=[{title:"Wrappers/Embed"},{component:T},{argTypes:{}},k(W)];let b={};for(let o=0;o<v.length;o+=1)b=z(b,v[o]);return t=new X({props:b}),r=new Z({props:{$$slots:{default:[oe,({args:o})=>({0:o}),({args:o})=>o?1:0]},$$scope:{ctx:g}}}),a=new ee({props:{name:"Default",args:{}}}),{c(){$(t.$$.fragment),n=S(),$(r.$$.fragment),d=S(),$(a.$$.fragment)},m(o,p){C(t,o,p),P(o,n,p),C(r,o,p),P(o,d,p),C(a,o,p),u=!0},p(o,[p]){const M=p&0?O(v,[v[0],p&0&&{component:T},v[2],p&0&&j(k(W))]):{};t.$set(M);const l={};p&3&&(l.$$scope={dirty:p,ctx:o}),r.$set(l)},i(o){u||(E(t.$$.fragment,o),E(r.$$.fragment,o),E(a.$$.fragment,o),u=!0)},o(o){I(t.$$.fragment,o),I(r.$$.fragment,o),I(a.$$.fragment,o),u=!1},d(o){x(t,o),o&&H(n),x(r,o),o&&H(d),x(a,o)}}}class de extends B{constructor(t){super(),N(this,t,null,le,D,{})}}const U=Q(de,{meta:{title:"Wrappers/Embed"},stories:{"tpl:default":{storyId:"wrappers-embed--default",name:"default",template:!0,source:`<Embed {...args}>
  <div style:padding="24px 0" style:background="lightgrey">
    <p style:margin="0">Embedded content.</p>
  </div>
</Embed>`,hasArgs:!0},Default:{storyId:"wrappers-embed--default",name:"Default",template:!1,hasArgs:!1}},allocatedIds:["default","Meta","Template","Story","componentDocs","Embed","withComponentDocs"]}),ue=U.meta,ce=["Default"],ge=U.stories.Default;export{ge as Default,ce as __namedExportsOrder,ue as default};
//# sourceMappingURL=Embed.stories-defd7eaf.js.map
